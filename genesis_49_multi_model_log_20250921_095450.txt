2025-09-21 09:54:50,242 - INFO - Successfully loaded environment variables from: C:\Users\ariro\OneDrive\Documents\Bible\.env
2025-09-21 09:54:50,242 - INFO - === PROCESSING GENESIS CHAPTER(S) [49] WITH MULTI-MODEL API ===
2025-09-21 09:54:50,242 - INFO - Initializing Sefaria client...
2025-09-21 09:54:50,243 - INFO - Initializing Metaphor Validator...
2025-09-21 09:54:50,243 - INFO - Initializing Gemini multi-model API...
2025-09-21 09:54:50,249 - INFO - Creating database: genesis_49_multi_model_20250921_095450.db
2025-09-21 09:54:50,500 - INFO - --- Processing Genesis 49 ---
2025-09-21 09:54:50,501 - INFO - Fetching text for Genesis 49...
2025-09-21 09:54:50,884 - INFO - Retrieved 33 verses for Genesis 49
2025-09-21 09:54:50,884 - INFO - Filtering to process 9 selected verse(s): [5, 6, 7, 8, 9, 10, 11, 12, 13]
2025-09-21 09:54:50,885 - INFO -   Processing Genesis 49:5 (1/9)...
2025-09-21 09:54:57,758 - INFO -     API Metadata: {'model_used': 'gemini-2.5-flash', 'context': 'poetic_blessing', 'retries': 0, 'input_tokens': 395, 'output_tokens': 1, 'fallback_used': False}
2025-09-21 09:54:57,763 - INFO -   Processing Genesis 49:6 (2/9)...
2025-09-21 09:55:04,712 - INFO -     API Metadata: {'model_used': 'gemini-2.5-flash', 'context': 'poetic_blessing', 'retries': 0, 'input_tokens': 582, 'output_tokens': 1, 'fallback_used': False}
2025-09-21 09:55:04,713 - INFO -   Processing Genesis 49:7 (3/9)...
2025-09-21 09:55:11,998 - INFO -     API Metadata: {'model_used': 'gemini-2.5-flash', 'context': 'poetic_blessing', 'retries': 0, 'input_tokens': 456, 'output_tokens': 1, 'fallback_used': False}
2025-09-21 09:55:11,999 - INFO -   Processing Genesis 49:8 (4/9)...
2025-09-21 09:55:26,781 - INFO -     VALIDATING instance: Your hand shall be on the nape of your foes
2025-09-21 09:55:27,502 - INFO -       VALIDATION PASSED: Cross-domain transfer (military → human).  The phrase uses the concrete image of controlling an enemy's nape—a military action signifying complete control—to represent Judah's future dominance over his adversaries.  It's not a literal description of continuous physical action but a symbolic representation of power and subjugation.
2025-09-21 09:55:27,503 - INFO -     API Metadata: {'model_used': 'gemini-2.5-flash', 'context': 'poetic_blessing', 'retries': 0, 'input_tokens': 452, 'output_tokens': 253, 'fallback_used': False}
2025-09-21 09:55:27,503 - INFO -     FOUND: 1 figurative instances
2025-09-21 09:55:27,504 - INFO -       Instance 1: metaphor - 'Your hand shall be on the nape of your foes'
2025-09-21 09:55:27,505 - INFO -   Processing Genesis 49:9 (5/9)...
2025-09-21 09:55:40,582 - INFO -     VALIDATING instance: Judah is a lion’s whelp
2025-09-21 09:55:41,372 - INFO -       VALIDATION PASSED: Cross-domain comparison (people as animals).  The statement directly equates Judah (a tribe/people) with a lion's whelp, transferring characteristics of strength and power from the animal kingdom to the human realm.  This is not a literal identification; it's a figurative description emphasizing Judah's inherent potential and aggressive nature.
2025-09-21 09:55:41,372 - INFO -     VALIDATING instance: On prey, my son, have you grown.
2025-09-21 09:55:42,217 - INFO -       VALIDATION PASSED: Cross-domain comparison (animal to human).  The passage uses the lion as a symbol to describe Judah's growth and strength, not as a literal statement about Judah being a lion.  The phrase "On prey, my son, have you grown" directly builds upon the established lion metaphor, illustrating Judah's success through conquest and dominance, mirroring a lion's sustenance from its kills.
2025-09-21 09:55:42,218 - INFO -     VALIDATING instance: He crouches, lies down like a lion,Like a lioness
2025-09-21 09:55:43,025 - INFO -       VALIDATION PASSED: This is a genuine simile employing a cross-domain comparison (animal to human).  The use of "כְּ" (ke-) clearly indicates a comparison, and the comparison is not literal; Judah is not literally a lion or lioness, but his strength and untouchable position are being compared to that of these powerful animals to create a vivid image of his dominance.
2025-09-21 09:55:43,026 - INFO -     API Metadata: {'model_used': 'gemini-2.5-flash', 'context': 'poetic_blessing', 'retries': 0, 'input_tokens': 521, 'output_tokens': 672, 'fallback_used': False}
2025-09-21 09:55:43,027 - INFO -     FOUND: 3 figurative instances
2025-09-21 09:55:43,027 - INFO -       Instance 1: metaphor - 'Judah is a lion’s whelp'
2025-09-21 09:55:43,027 - INFO -       Instance 2: metaphor - 'On prey, my son, have you grown.'
2025-09-21 09:55:43,027 - INFO -       Instance 3: simile - 'He crouches, lies down like a lion,Like a lioness'
2025-09-21 09:55:43,028 - INFO -   Processing Genesis 49:10 (6/9)...
2025-09-21 09:56:08,082 - INFO -     VALIDATING instance: scepter
2025-09-21 09:56:08,762 - INFO -       VALIDATION PASSED: Metonymy - The scepter is used as a synecdoche (a type of metonymy) representing the entirety of royal authority and the kingdom of Judah.  The statement isn't about the literal scepter itself, but uses it to represent the enduring power and kingship of Judah.
2025-09-21 09:56:08,762 - INFO -     VALIDATING instance: ruler’s staff
2025-09-21 09:56:09,550 - INFO -       VALIDATION PASSED: Metonymy - The "ruler's staff" is not merely a literal object; it functions as a synecdoche representing the authority and enduring power of Judah's leadership.  The text doesn't describe the staff itself, but uses it to represent the abstract concept of governance.  The enduring nature of the staff symbolizes the enduring nature of Judah's rule.
2025-09-21 09:56:09,550 - INFO -     API Metadata: {'model_used': 'gemini-2.5-flash', 'context': 'poetic_blessing', 'retries': 0, 'input_tokens': 523, 'output_tokens': 420, 'fallback_used': False}
2025-09-21 09:56:09,551 - INFO -     FOUND: 2 figurative instances
2025-09-21 09:56:09,551 - INFO -       Instance 1: metonymy - 'scepter'
2025-09-21 09:56:09,552 - INFO -       Instance 2: metonymy - 'ruler’s staff'
2025-09-21 09:56:09,552 - INFO -   Processing Genesis 49:11 (7/9)...
2025-09-21 09:56:29,268 - INFO -     VALIDATING instance: He tethers his ass to a vine, His ass’s foal to a choice vine;
2025-09-21 09:56:29,963 - INFO -       VALIDATION PASSED: Hyperbole depicting extreme abundance.  The image of tethering donkeys to valuable vines is clearly not a literal description of animal husbandry but a figurative exaggeration to convey the immense prosperity of the vineyards.  It's a cross-domain comparison (agricultural practice to economic wealth) fitting the definition of metaphor.
2025-09-21 09:56:29,964 - INFO -     VALIDATING instance: He washes his garment in wine, His robe in blood of grapes.
2025-09-21 09:56:30,647 - INFO -       VALIDATION PASSED: Hyperbole depicting abundance.  The act of washing clothes in wine is clearly impractical and exaggerates the vast quantity of wine available, functioning as a figurative expression of prosperity rather than a literal description of a practice.  The phrase "blood of grapes" is a recognized idiom for wine, further reinforcing the figurative nature of the statement.
2025-09-21 09:56:30,648 - INFO -     API Metadata: {'model_used': 'gemini-2.5-flash', 'context': 'poetic_blessing', 'retries': 0, 'input_tokens': 468, 'output_tokens': 526, 'fallback_used': False}
2025-09-21 09:56:30,648 - INFO -     FOUND: 2 figurative instances
2025-09-21 09:56:30,649 - INFO -       Instance 1: metaphor - 'He tethers his ass to a vine, His ass’s foal to a choice vine;'
2025-09-21 09:56:30,649 - INFO -       Instance 2: metaphor - 'He washes his garment in wine, His robe in blood of grapes.'
2025-09-21 09:56:30,650 - INFO -   Processing Genesis 49:12 (8/9)...
2025-09-21 09:56:45,102 - INFO -     VALIDATING instance: His eyes are darker than wine
2025-09-21 09:56:45,783 - INFO -       VALIDATION PASSED: Cross-domain comparison using nature imagery (wine's darkness) to describe a human characteristic (eye color).  The comparison is not literal; it uses the qualities of wine to create a vivid image of the subject's dark eyes.  The use of "than" clearly indicates a figurative comparison of dissimilar things.
2025-09-21 09:56:45,784 - INFO -     VALIDATING instance: His teeth are whiter than milk
2025-09-21 09:56:46,352 - INFO -       VALIDATION PASSED: Cross-domain comparison using nature imagery (milk) to describe a human characteristic (whiteness of teeth).  The comparison is not literal; teeth are not milk, but the simile effectively conveys the intense whiteness.
2025-09-21 09:56:46,352 - INFO -     API Metadata: {'model_used': 'gemini-2.5-flash', 'context': 'poetic_blessing', 'retries': 0, 'input_tokens': 438, 'output_tokens': 472, 'fallback_used': False}
2025-09-21 09:56:46,353 - INFO -     FOUND: 2 figurative instances
2025-09-21 09:56:46,353 - INFO -       Instance 1: simile - 'His eyes are darker than wine'
2025-09-21 09:56:46,353 - INFO -       Instance 2: simile - 'His teeth are whiter than milk'
2025-09-21 09:56:46,354 - INFO -   Processing Genesis 49:13 (9/9)...
2025-09-21 09:57:04,919 - INFO -     VALIDATING instance: He shall be a haven for ships
2025-09-21 09:57:05,474 - INFO -       VALIDATION PASSED: Cross-domain comparison - A geographical feature (haven) is used to describe a tribe's economic and strategic role.  Zebulun is not literally a harbor, but the metaphor effectively conveys its maritime importance.
2025-09-21 09:57:05,474 - INFO -     VALIDATING instance: And his flank shall rest on Sidon
2025-09-21 09:57:06,515 - INFO -       VALIDATION PASSED: The phrase uses the tribe of Zebulun as a geographical entity, comparing its border with Sidon to a body part resting against another.  It's not attributing human-like qualities or actions to Zebulun in a way that constitutes personification.  Instead, it uses a spatial metaphor to describe the territorial extent of Zebulun's land.  The "flank" of Zebulun is not acting; it's a descriptive element used to convey the geographical relationship between Zebulun and Sidon.
2025-09-21 09:57:06,516 - INFO -       RECLASSIFIED to: Metaphor
2025-09-21 09:57:06,516 - INFO -     API Metadata: {'model_used': 'gemini-2.5-flash', 'context': 'poetic_blessing', 'retries': 0, 'input_tokens': 441, 'output_tokens': 858, 'fallback_used': False}
2025-09-21 09:57:06,517 - INFO -     FOUND: 2 figurative instances
2025-09-21 09:57:06,518 - INFO -       Instance 1: metaphor - 'He shall be a haven for ships'
2025-09-21 09:57:06,518 - ERROR - Unexpected error processing verse Genesis 49:13: CHECK constraint failed: type IN ('metaphor', 'simile', 'personification', 'idiom', 'hyperbole', 'metonymy', 'other')
2025-09-21 09:57:06,554 - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\ariro\OneDrive\Documents\Bible\interactive_multi_model_processor.py", line 207, in process_chapter
    db_manager.insert_figurative_language(verse_id, figurative_data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ariro\OneDrive\Documents\Bible\src\hebrew_figurative_db\database\db_manager.py", line 114, in insert_figurative_language
    self.cursor.execute('''
    ~~~~~~~~~~~~~~~~~~~^^^^
        INSERT INTO figurative_language
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<14 lines>...
        figurative_data.get('purpose')
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
sqlite3.IntegrityError: CHECK constraint failed: type IN ('metaphor', 'simile', 'personification', 'idiom', 'hyperbole', 'metonymy', 'other')

2025-09-21 09:57:06,554 - INFO - Genesis 49 COMPLETED: 12 figurative instances from 9 verses
2025-09-21 09:57:06,563 - INFO - 
=== GENESIS PROCESSING COMPLETE ===
2025-09-21 09:57:06,564 - INFO - Database: genesis_49_multi_model_20250921_095450.db
2025-09-21 09:57:06,564 - INFO - Log file: genesis_49_multi_model_log_20250921_095450.txt
2025-09-21 09:57:06,565 - INFO - Total verses processed: 9
2025-09-21 09:57:06,565 - INFO - Total figurative instances: 12
2025-09-21 09:57:06,566 - INFO - Errors: 1
2025-09-21 09:57:06,567 - INFO - Processing time: 136.3 seconds
2025-09-21 09:57:06,568 - INFO - 
--- Multi-Model API Usage Statistics ---
2025-09-21 09:57:06,568 - INFO - Total Requests: 9
2025-09-21 09:57:06,569 - INFO - Primary Success: 9
2025-09-21 09:57:06,569 - INFO - Fallback Used: 0
2025-09-21 09:57:06,569 - INFO - Primary Success Rate: 1.0
2025-09-21 09:57:06,570 - INFO - Fallback Rate: 0.0
2025-09-21 09:57:06,570 - INFO - Total Input Tokens: 4276
2025-09-21 09:57:06,570 - INFO - Total Output Tokens: 3204
2025-09-21 09:57:06,571 - INFO - Total Tokens: 7480
2025-09-21 09:57:06,571 - INFO - Primary Model: gemini-2.5-flash
2025-09-21 09:57:06,572 - INFO - Fallback Model: gemini-1.5-flash
2025-09-21 09:57:06,572 - INFO - Restriction Reasons: []
